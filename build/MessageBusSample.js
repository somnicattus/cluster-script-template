var o="messageBusInitialized",u="subscribe",c="unsubscribe",b="publish";var l=100;$.onStart(()=>{$.getItemsNear($.getPosition(),l).forEach((s)=>{s.send(o,null)})});$.onReceive((n,s,i)=>{if(n===u){if(typeof s!=="object"||s===null||!("channelId"in s)||typeof s.channelId!=="number"){$.log("Invalid argument for subscribe message.");return}let{channelId:e}=s;$.state.subscriptions[e]=[...$.state.subscriptions[e]??[],i];return}if(n===c){if(typeof s!=="object"||s===null||!("channelId"in s)||typeof s.channelId!=="number"){$.log("Invalid argument for unsubscribe message.");return}let{channelId:e}=s;$.state.subscriptions[e]=$.state.subscriptions[e]?.filter((t)=>t!==i);return}if(n===b){if(typeof s!=="object"||s===null||!("messageType"in s)||typeof s.messageType!=="string"||!("channelId"in s)||typeof s.channelId!=="number"){$.log("Invalid argument for publish message.");return}let{messageType:e,channelId:t}=s;($.state.subscriptions[t]??[]).forEach((r)=>{r.send(e,s.arg??null)})}});
